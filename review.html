<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<title>評分頁面</title>

<!-- Common links -->
<!----><link rel="icon" type="image/png" href="/include/icon.png" />
<!----><link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
<!----><script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<!----><script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<!----><script type="text/javascript" src="http://www.parsecdn.com/js/parse-1.2.19.min.js"></script>
<!----><link href="/css/all.css" rel="stylesheet" />
<!----><script src="/js/all.js"></script>
<!---------------------->

<link rel="stylesheet" href="jquery-ui/jquery-ui.css">
<script type="text/javascript" src="jquery-ui/jquery-ui.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/ace.js" type="text/javascript" charset="utf-8"></script>



<style>
html {
  margin:0;
  padding:0;
  overflow-x:hidden;
}
.play {
	background:gray;
	height:100%;
	padding:0;
	position:relative;
}
.play iframe {
	position: absolute;
	top: 50%;
	left: 50%;
	margin-right: -50%;
	transform: translate(-50%, -50%)	;
}
.editor-container {
	position:relative;
	height:100%;
	
}
 .editor { 
	margin: 0;
	position: absolute;
	top: 0;
	bottom: 0;
	left: 0;
	right: 0;
}
.tab-pane{
	height:600px;
	height:-webkit-calc(100vh - 42px); 
}

.expand {
	width:50%;
	background:rgba(199,199,199,1.00);
	float:left;
}
.source { 
 color:rgba(53,53,53,1.00);
}

.no-padding  {
	padding:0 !important;
}


.grade-preview {
	display:inline;
}
</style>


</head>

<body>
<div class="row">
	<div class="container-fluid">
	</div>
</div>
<div class="row">
<div class=" container-fluid">
<!-- Nav tabs -->
<ul class="nav nav-tabs" role="tablist">
  <li class="title disabled"><a >Assign</a></li>
	<li class="active">
			<a href="#assign1" role="tab" data-toggle="tab">#1 <div class="grade-preview"></div></a></li>
  <li><a href="#assign2" role="tab" data-toggle="tab">#2 <div class="grade-preview"></div></a></li>
  <li><a href="#assign3" role="tab" data-toggle="tab">#3 <div class="grade-preview"></div></a></li>
  <li><a href="#assign4" role="tab" data-toggle="tab">#4 <div class="grade-preview"></div></a></li>
  <li><a href="#assign5" role="tab" data-toggle="tab">#5 <div class="grade-preview"></div></a></li>

</ul>

<!-- Tab panes -->
<div class="tab-content ">
  <div  class="tab-pane fade row  in active" id="assign1">
		<div class="play col-xs-7"></div><div class="editor-container col-xs-5"><div class="editor"></div></div><div></div>
	</div>
  <div class="tab-pane fade row" id="assign2">B</div>
  <div class="tab-pane fade row" id="assign3">C</div>
  <div class="tab-pane fade row" id="assign4">D</div>
  <div class="tab-pane fade row" id="assign5">E</div>
</div>

</div>
</div>



<!--div class="row">
	<div class="one-game container no-padding">
		<div class="expand game">
			<iframe src="final_11/index.html" width="100%" frameborder="0" height="313"></iframe>
		</div>
		<div class="expand source" style="height:313px; overflow:hidden;">
			
		</div>
	</div>
</div-->

<script>
$('#myTab a').click(function (e) {
  e.preventDefault();
  $(this).tab('show');
})

/*
$(document).on("mouseover",".game", function (){
	$(this).animate({width:"60%"},300);
	
	$(this).siblings(".source").animate({width:"40%"},300);
	//alert ("yes");
});

$(document).on("mouseover",".source", function (){
	$(this).animate({width:"60%"},300);
	$(this).siblings(".game").animate({width:"40%"},300);
});
*/
Parse.initialize("9eo5r1mHWoIPSTCzmrpdKa3lcHPjySx4y5D6q8Nq", "R8SWwYxpJcy73ogQKuSD43y7FigrlDGjBLcy1lzC");	
var currentUser = Parse.User.current();		

var assignToReview = "1";
var Assign = Parse.Object.extend("Assign");
var assign = new Assign();
var q = new Parse.Query(Assign);
q.equalTo("uid",currentUser.get("authData").facebook.id );
q.equalTo("assign",assignToReview);
q.first().then(function(r){
	console.log("Parse Done, Querying Data..");
	var url = r.get("url");
	
	isInTime(url);
},function(e){
	console.log(e.message);
});

function isInTime(url){
	console.log("Check Last Modified...");
		$.ajax({
			url : "lastModify.php",
			async : false,
			type: "POST",
			data:{url:url},
			dataType : 'text', //explicitly requesting the xml as text, rather than an xml document
			success : function (data, status, xhr) {	
				console.log (data);
				
				getCode(url,"assign1");
				var play = document.createElement("iframe");
				play.style.width = "100%";
				play.style.height = "400px";
				play.setAttribute("src",url);
				$("#assign1").find(".play").first().html(play);
			
			
			
			}
		});
}

</script>

<script data-file="這是程式預覽" >
function getCode (url,id){
		console.log("Ajaxing");
		$.ajax({
			url : "/getcode.php",
			async : true,
			type: "POST",
			data:{url:url},
			dataType : 'text', //explicitly requesting the xml as text, rather than an xml document
			success : function (data, status, xhr) {		
				if (status == 'success') {
					var tabEditor = $("#"+id).find(".editor").first().get(0);
					console.log(tabEditor);
	
					var editor = ace.edit( tabEditor );
					editor.setTheme("ace/theme/twilight");
					editor.getSession().setUseWrapMode(true);
					editor.getSession().setTabSize(2);
					tabEditor.style.fontSize='14px';
					editor.getSession().setMode("ace/mode/java");
					editor.setValue(data);
				}	
			}
		});
}
</script>
</body>
</html>
